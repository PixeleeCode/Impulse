!function(){"use strict";function e(e,t,n,i){return new(n||(n=Promise))((function(o,l){function r(e){try{s(i.next(e))}catch(e){l(e)}}function u(e){try{s(i.throw(e))}catch(e){l(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,u)}s((i=i.apply(e,t||[])).next())}))}function t(e){if(e.id)return`#${e.id}`;const t=["name","impulse:input","impulse:change","placeholder","type"];for(const n of t){const t=e.getAttribute(n);if(t)return`[${n}="${t}"]`}let n=e.tagName.toLowerCase();if(e.parentElement){const t=Array.from(e.parentElement.children).indexOf(e);t>-1&&(n+=`:nth-child(${t+1})`)}return n}function n(){document.querySelectorAll("[impulse\\:click]").forEach((e=>{e._impulseBoundClick||(e._impulseBoundClick=!0,e.addEventListener("click",(t=>{t.preventDefault();const n=e.getAttribute("impulse:click"),i=e.closest("[data-impulse-id]");n&&i&&l(i.getAttribute("data-impulse-id"),n,void 0,{update:e.getAttribute("impulse:update")||void 0})})))})),document.querySelectorAll("[impulse\\:input]").forEach((e=>{e._impulseBoundInput||(e._impulseBoundInput=!0,e.addEventListener("input",(n=>{const i=e.getAttribute("impulse:input"),o=e.closest("[data-impulse-id]");if(!i||!o)return;const r=o.getAttribute("data-impulse-id"),u=n.target.value;let s=e.getAttribute("impulse:update")||void 0;const a=document.activeElement,d=a===e,c=d?a.selectionStart:null,m=d?a.selectionEnd:null;l(r,i,u,{activeElementId:d?a.id:null,activeElementSelector:d?t(a):null,selectionStart:c,selectionEnd:m,caretPosition:c,update:s})})))})),document.querySelectorAll("[impulse\\:change]").forEach((e=>{e._impulseBoundChange||(e._impulseBoundChange=!0,e.addEventListener("change",(n=>{const i=e.getAttribute("impulse:change"),o=e.closest("[data-impulse-id]");if(!i||!o)return;const r=o.getAttribute("data-impulse-id"),u=n.target.value;let s=e.getAttribute("impulse:update")||void 0;const a=void 0!==e.selectedIndex?e.selectedIndex:-1;l(r,i,u,{activeElementId:e.id,activeElementSelector:t(e),selectedIndex:a,update:s})})))})),document.querySelectorAll("[impulse\\:blur]").forEach((e=>{e._impulseBoundBlur||(e._impulseBoundBlur=!0,e.addEventListener("blur",(t=>{const n=e.getAttribute("impulse:blur"),i=e.closest("[data-impulse-id]");n&&i&&l(i.getAttribute("data-impulse-id"),n,t.target.value,{update:e.getAttribute("impulse:update")||void 0})})))})),document.querySelectorAll("[impulse\\:keydown]").forEach((e=>{e._impulseBoundKeyDown||(e._impulseBoundKeyDown=!0,e.addEventListener("keydown",(t=>{const n=e.getAttribute("impulse:keydown"),i=e.closest("[data-impulse-id]");if(!n||!i)return;const o=i.getAttribute("data-impulse-id");let r=e.getAttribute("impulse:update")||void 0;l(o,`${n}('${t.key}')`,void 0,{update:r})})))})),document.querySelectorAll("[impulse\\:submit]").forEach((e=>{e._impulseBoundSubmit||(e._impulseBoundSubmit=!0,e.addEventListener("submit",(t=>{var n;t.preventDefault();const i=e.getAttribute("impulse:submit"),o=null===(n=e.closest("[data-impulse-id]"))||void 0===n?void 0:n.getAttribute("data-impulse-id");i&&o&&l(o,i,void 0,{update:e.getAttribute("impulse:update")||void 0})})))})),document.querySelectorAll("[impulse\\:emit]").forEach((e=>{if(e._impulseBoundEmit)return;e._impulseBoundEmit=!0;const t="form"===e.tagName.toLowerCase(),n=t?"submit":"click";e.addEventListener(n,(n=>{n.preventDefault();const i=e.getAttribute("impulse:emit");if(!i)return;let o={};if(t)new FormData(e).forEach(((e,t)=>o[t]=e));else{const t=e.getAttribute("impulse:payload");if(t)try{o=JSON.parse(t)}catch(e){o={value:t}}}Impulse.emit(i,o,{callback:t=>{"function"==typeof e._onImpulseResult?e._onImpulseResult(t):e.dispatchEvent(new CustomEvent("impulse:result",{detail:t,bubbles:!0}))}})}))}))}function i(t){return e(this,void 0,void 0,(function*(){var e;const n=yield fetch("impulse.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),i=yield n.text();if((null===(e=n.headers.get("content-type"))||void 0===e?void 0:e.includes("application/json"))||i.trim().startsWith("{")&&i.trim().endsWith("}"))try{const e=JSON.parse(i);if(e.error)return function(e){var t;let n=document.getElementById("impulse-error-container");n||(n=document.createElement("div"),n.id="impulse-error-container",n.style.position="fixed",n.style.top="24px",n.style.right="24px",n.style.zIndex="9999",n.style.display="flex",n.style.flexDirection="column",n.style.alignItems="flex-end",n.style.gap="12px",n.style.pointerEvents="none",document.body.appendChild(n));const i=Array.from(n.children).some((t=>{var n;return null===(n=t.textContent)||void 0===n?void 0:n.replace(/\s+/g," ").includes(e)}));if(i)return;const o=document.createElement("div");o.style.background="#b91c1c",o.style.color="#fff",o.style.padding="12px",o.style.fontFamily="sans-serif",o.style.borderRadius="8px",o.style.boxShadow="0 2px 12px #0003",o.style.opacity="1",o.style.minWidth="280px",o.style.pointerEvents="auto",o.style.transition="opacity 0.4s, transform 0.4s",o.style.marginTop="0",o.style.marginBottom="0",o.innerHTML=`\n    <span style="vertical-align:middle;">${e}</span>\n    <button style="margin-left:24px;background:transparent;border:none;color:#fff;font-size:22px;cursor:pointer;vertical-align:middle;" aria-label="Fermer">&times;</button>\n  `,null===(t=o.querySelector("button"))||void 0===t||t.addEventListener("click",(()=>{o.style.opacity="0",o.style.transform="translateX(60px)",setTimeout((()=>o.remove()),400)})),n.appendChild(o),setTimeout((()=>{o.parentNode&&(o.style.opacity="0",o.style.transform="translateX(60px)",setTimeout((()=>o.remove()),400))}),6e3)}(e.message),Promise.reject(e.error)}catch(e){console.warn("Impulse: failed to parse error JSON.",e)}return i}))}function o(e,t){setTimeout((()=>{const n=function(e,t){let n=null;if(t.activeElementId&&(n=document.getElementById(t.activeElementId)),!n&&t.activeElementSelector)try{t.activeElementId&&(n=e.querySelector(`#${t.activeElementId}`)),n||(n=e.querySelector(t.activeElementSelector))}catch(e){console.warn("Impossible de trouver l'élément avec le sélecteur:",t.activeElementSelector,". Ajouter un ID à votre élément pour le rendre accessible. Erreur:",e)}return n}(e,t);n&&("SELECT"===n.tagName&&"number"==typeof t.selectedIndex&&(n.selectedIndex=t.selectedIndex),"focus"in n&&n.focus(),"setSelectionRange"in n&&"number"==typeof t.selectionStart&&"number"==typeof t.selectionEnd&&requestAnimationFrame((()=>{n.setSelectionRange(t.selectionStart,t.selectionEnd)})))}),0)}function l(t,l,r,u){return e(this,void 0,void 0,(function*(){const e=function(e){const t=document.querySelector(`[data-impulse-id="${e}"]`);let n={};if(t&&t.hasAttribute("data-states"))try{n=JSON.parse(t.getAttribute("data-states")||"{}")}catch(e){n={}}return t&&t.querySelectorAll("[impulse\\:input], [impulse\\:change]").forEach((e=>{const t=e.getAttribute("name")||e.getAttribute("id");t&&(n[t]=e.value)})),n}(t),s={id:t,action:l,states:e};(null==u?void 0:u.update)&&(s.update=u.update),void 0!==r&&(s.value=r);const a=document.querySelector(`[data-impulse-id="${t}"]`),d=null==a?void 0:a.getAttribute("data-impulse-slot");d&&(s.slot=atob(d));try{const e=yield i(s);!function(e,t,i){const l=document.createElement("div");l.innerHTML=t;const r=l.querySelector("[data-impulse-id]");try{const n=JSON.parse(t);if(n&&"object"==typeof n&&n.fragments){if(Object.entries(n.fragments).forEach((([e,t])=>{const[n,i]=e.split("@"),o=`[data-impulse-update^="${n}@"]`;document.querySelectorAll(o).forEach((e=>{const n=e.getAttribute("data-impulse-update");if(!n)return;const o=n.split("@")[1];if(o&&o===i){const n=document.createElement("div");n.innerHTML=t.trim();const i=n.firstElementChild;i?e.replaceWith(i):e.innerHTML=t}}))})),n.states){const t=document.querySelector(`[data-impulse-id="${e}"]`);t&&t.setAttribute("data-states",JSON.stringify(n.states))}return}}catch(e){}if(null==i?void 0:i.update){let n=null;try{const e=JSON.parse(t);e&&"object"==typeof e&&e.result&&(t=e.result,n=e.states)}catch(e){}const o=document.querySelector(`[data-impulse-id="${e}"]`),l=null==o?void 0:o.querySelector(`[data-impulse-update="${i.update}"]`);if(l){const e=document.createElement("div");e.innerHTML=t.trim();const i=e.firstElementChild;return void(i?(l.replaceWith(i),n&&o&&o.setAttribute("data-states",JSON.stringify(n))):(l.innerHTML=t,n&&o&&o.setAttribute("data-states",JSON.stringify(n))))}}const u=document.querySelector(`[data-impulse-id="${e}"]`);r&&u&&u.parentNode&&(u.parentNode.replaceChild(r,u),n(),i&&o(r,i))}(t,e,u)}catch(e){console.error("Impulse error:",e)}}))}function r(t){return e(this,arguments,void 0,(function*(e,t={},i={}){const o=(l=i.components)?Array.isArray(l)?l:[l]:Array.from(document.querySelectorAll("[data-impulse-id]")).map((e=>e.getAttribute("data-impulse-id"))).filter(Boolean);var l;const r=yield fetch("/impulse.php",{method:"POST",headers:Object.assign({"Content-Type":"application/json"},i.headers||{}),body:JSON.stringify(Object.assign({emit:e,payload:t,components:o},i.extra)),credentials:"same-origin"});let u=null;const s=yield r.text();try{u=JSON.parse(s),document.dispatchEvent(new CustomEvent("impulse:emit",{detail:{event:e,payload:t}})),u.updates&&(u.updates.forEach((e=>{const t=document.createElement("div");t.innerHTML=e.html.trim();const n=t.querySelector("[data-impulse-id]"),i=document.querySelector(`[data-impulse-id="${e.component}"]`);n&&i&&i.parentNode&&i.parentNode.replaceChild(n,i)})),n())}catch(e){u=s}return"function"==typeof i.callback&&i.callback(u),u}))}function u(){n(),setTimeout((()=>{n()}),100)}"function"==typeof SuppressedError&&SuppressedError,function(){const e={emit:r};"undefined"!=typeof window&&(window.Impulse=e,setTimeout((()=>{"undefined"!=typeof document&&document.dispatchEvent(new CustomEvent("impulse:ready",{detail:{Impulse:window.Impulse}}))}),0)),"undefined"!=typeof module&&module.exports&&(module.exports={Impulse:e})}(),"undefined"!=typeof document&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",u):u())}();
//# sourceMappingURL=impulse.js.map
