!function(){"use strict";function e(e,t,n,i){return new(n||(n=Promise))((function(l,o){function r(e){try{s(i.next(e))}catch(e){o(e)}}function u(e){try{s(i.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?l(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,u)}s((i=i.apply(e,t||[])).next())}))}function t(e){if(e.id)return`#${e.id}`;const t=["name","impulse:input","impulse:change","placeholder","type"];for(const n of t){const t=e.getAttribute(n);if(t)return`[${n}="${t}"]`}let n=e.tagName.toLowerCase();if(e.parentElement){const t=Array.from(e.parentElement.children).indexOf(e);t>-1&&(n+=`:nth-child(${t+1})`)}return n}function n(){document.querySelectorAll("[impulse\\:click]").forEach((e=>{e._impulseBoundClick||(e._impulseBoundClick=!0,e.addEventListener("click",(t=>{t.preventDefault();const n=e.getAttribute("impulse:click"),l=e.closest("[data-impulse-id]");if(!n||!l)return;i(l.getAttribute("data-impulse-id"),n,void 0,{update:e.getAttribute("impulse:update")||void 0})})))})),document.querySelectorAll("[impulse\\:input]").forEach((e=>{e._impulseBoundInput||(e._impulseBoundInput=!0,e.addEventListener("input",(n=>{const l=e.getAttribute("impulse:input"),o=e.closest("[data-impulse-id]");if(!l||!o)return;const r=o.getAttribute("data-impulse-id"),u=n.target.value;let s=e.getAttribute("impulse:update")||void 0;const a=document.activeElement,d=a===e,c=d?a.selectionStart:null,m=d?a.selectionEnd:null;i(r,l,u,{activeElementId:d?a.id:null,activeElementSelector:d?t(a):null,selectionStart:c,selectionEnd:m,caretPosition:c,update:s})})))})),document.querySelectorAll("[impulse\\:change]").forEach((e=>{e._impulseBoundChange||(e._impulseBoundChange=!0,e.addEventListener("change",(n=>{const l=e.getAttribute("impulse:change"),o=e.closest("[data-impulse-id]");if(!l||!o)return;const r=o.getAttribute("data-impulse-id"),u=n.target.value;let s=e.getAttribute("impulse:update")||void 0;const a=void 0!==e.selectedIndex?e.selectedIndex:-1;i(r,l,u,{activeElementId:e.id,activeElementSelector:t(e),selectedIndex:a,update:s})})))})),document.querySelectorAll("[impulse\\:blur]").forEach((e=>{e._impulseBoundBlur||(e._impulseBoundBlur=!0,e.addEventListener("blur",(t=>{const n=e.getAttribute("impulse:blur"),l=e.closest("[data-impulse-id]");if(!n||!l)return;i(l.getAttribute("data-impulse-id"),n,t.target.value,{update:e.getAttribute("impulse:update")||void 0})})))})),document.querySelectorAll("[impulse\\:keydown]").forEach((e=>{e._impulseBoundKeyDown||(e._impulseBoundKeyDown=!0,e.addEventListener("keydown",(t=>{const n=e.getAttribute("impulse:keydown"),l=e.closest("[data-impulse-id]");if(!n||!l)return;const o=l.getAttribute("data-impulse-id");let r=e.getAttribute("impulse:update")||void 0;i(o,`${n}('${t.key}')`,void 0,{update:r})})))})),document.querySelectorAll("[impulse\\:submit]").forEach((e=>{e._impulseBoundSubmit||(e._impulseBoundSubmit=!0,e.addEventListener("submit",(t=>{var n;t.preventDefault();const l=e.getAttribute("impulse:submit"),o=null===(n=e.closest("[data-impulse-id]"))||void 0===n?void 0:n.getAttribute("data-impulse-id");if(!l||!o)return;i(o,l,void 0,{update:e.getAttribute("impulse:update")||void 0})})))})),document.querySelectorAll("[impulse\\:emit]").forEach((e=>{if(e._impulseBoundEmit)return;e._impulseBoundEmit=!0;const t="form"===e.tagName.toLowerCase(),n=t?"submit":"click";e.addEventListener(n,(n=>{n.preventDefault();const i=e.getAttribute("impulse:emit");if(!i)return;let l={};if(t){new FormData(e).forEach(((e,t)=>l[t]=e))}else{const t=e.getAttribute("impulse:payload");if(t)try{l=JSON.parse(t)}catch(e){l={value:t}}}Impulse.emit(i,l,{callback:t=>{"function"==typeof e._onImpulseResult?e._onImpulseResult(t):e.dispatchEvent(new CustomEvent("impulse:result",{detail:t,bubbles:!0}))}})}))}))}function i(t,i,l,o){const r=document.querySelector(`[data-impulse-id="${t}"]`);let u={};if(r&&r.hasAttribute("data-states"))try{u=JSON.parse(r.getAttribute("data-states")||"{}")}catch(e){u={}}r&&r.querySelectorAll("[impulse\\:input], [impulse\\:change]").forEach((e=>{const t=e.getAttribute("name")||e.getAttribute("id");t&&(u[t]=e.value)}));const s={id:t,action:i,states:u};(null==o?void 0:o.update)&&(s.update=o.update),void 0!==l&&(s.value=l),fetch("impulse.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).then((t=>e(this,void 0,void 0,(function*(){var e;const n=yield t.text();if((null===(e=t.headers.get("content-type"))||void 0===e?void 0:e.includes("application/json"))||n.trim().startsWith("{")&&n.trim().endsWith("}"))try{const e=JSON.parse(n);if(e.error)throw function(e){var t;let n=document.getElementById("impulse-error-container");n||(n=document.createElement("div"),n.id="impulse-error-container",n.style.position="fixed",n.style.top="24px",n.style.right="24px",n.style.zIndex="9999",n.style.display="flex",n.style.flexDirection="column",n.style.alignItems="flex-end",n.style.gap="12px",n.style.pointerEvents="none",document.body.appendChild(n));const i=Array.from(n.children).some((t=>{var n;return null===(n=t.textContent)||void 0===n?void 0:n.replace(/\s+/g," ").includes(e)}));if(i)return;const l=document.createElement("div");l.style.background="#b91c1c",l.style.color="#fff",l.style.padding="12px",l.style.fontFamily="sans-serif",l.style.borderRadius="8px",l.style.boxShadow="0 2px 12px #0003",l.style.opacity="1",l.style.minWidth="280px",l.style.pointerEvents="auto",l.style.transition="opacity 0.4s, transform 0.4s",l.style.marginTop="0",l.style.marginBottom="0",l.innerHTML=`\n    <span style="vertical-align:middle;">${e}</span>\n    <button style="margin-left:24px;background:transparent;border:none;color:#fff;font-size:22px;cursor:pointer;vertical-align:middle;" aria-label="Fermer">&times;</button>\n  `,null===(t=l.querySelector("button"))||void 0===t||t.addEventListener("click",(()=>{l.style.opacity="0",l.style.transform="translateX(60px)",setTimeout((()=>l.remove()),400)})),n.appendChild(l),setTimeout((()=>{l.parentNode&&(l.style.opacity="0",l.style.transform="translateX(60px)",setTimeout((()=>l.remove()),400))}),6e3)}(e.message),new Error(e.message)}catch(e){console.warn("Impulse: failed to parse error JSON.",e)}return n})))).then((e=>{const i=document.createElement("div");i.innerHTML=e;const l=i.querySelector("[data-impulse-id]");if(null==o?void 0:o.update){let n=null;try{const t=JSON.parse(e);t&&"object"==typeof t&&t.result&&(e=t.result,n=t.states)}catch(e){}const i=document.querySelector(`[data-impulse-id="${t}"]`),l=null==i?void 0:i.querySelector(`[data-impulse-update="${o.update}"]`);if(l){const t=document.createElement("div");t.innerHTML=e.trim();const o=t.firstElementChild;return void(o?(l.replaceWith(o),n&&i&&i.setAttribute("data-states",JSON.stringify(n))):(l.innerHTML=e,n&&i&&i.setAttribute("data-states",JSON.stringify(n))))}}const r=document.querySelector(`[data-impulse-id="${t}"]`);l&&r&&r.parentNode&&(r.parentNode.replaceChild(l,r),n(),o&&setTimeout((()=>{let e=null;if(o.activeElementId&&(e=document.getElementById(o.activeElementId)),!e&&o.activeElementSelector)try{o.activeElementId&&(e=l.querySelector(`#${o.activeElementId}`)),e||(e=l.querySelector(o.activeElementSelector))}catch(e){console.warn("Impossible de trouver l'élément avec le sélecteur:",o.activeElementSelector,". Ajouter un ID à votre élément pour le rendre accessible. Erreur:",e)}e&&("SELECT"===e.tagName&&"number"==typeof o.selectedIndex&&(e.selectedIndex=o.selectedIndex),"focus"in e&&e.focus(),"setSelectionRange"in e&&"number"==typeof o.selectionStart&&"number"==typeof o.selectionEnd&&requestAnimationFrame((()=>{e.setSelectionRange(o.selectionStart,o.selectionEnd)})))}),0))})).catch((e=>console.error("Impulse error:",e)))}function l(t){return e(this,arguments,void 0,(function*(e,t={},i={}){const l=(o=i.components)?Array.isArray(o)?o:[o]:Array.from(document.querySelectorAll("[data-impulse-id]")).map((e=>e.getAttribute("data-impulse-id"))).filter(Boolean);var o;const r=yield fetch("/impulse.php",{method:"POST",headers:Object.assign({"Content-Type":"application/json"},i.headers||{}),body:JSON.stringify(Object.assign({emit:e,payload:t,components:l},i.extra)),credentials:"same-origin"});let u=null;const s=yield r.text();try{u=JSON.parse(s),document.dispatchEvent(new CustomEvent("impulse:emit",{detail:{event:e,payload:t}})),u.updates&&(u.updates.forEach((e=>{const t=document.createElement("div");t.innerHTML=e.html.trim();const n=t.querySelector("[data-impulse-id]"),i=document.querySelector(`[data-impulse-id="${e.component}"]`);n&&i&&i.parentNode&&i.parentNode.replaceChild(n,i)})),n())}catch(e){u=s}return"function"==typeof i.callback&&i.callback(u),u}))}function o(){n(),setTimeout((()=>{n()}),100)}"function"==typeof SuppressedError&&SuppressedError,function(){const e={emit:l};"undefined"!=typeof window&&(window.Impulse=e,setTimeout((()=>{"undefined"!=typeof document&&document.dispatchEvent(new CustomEvent("impulse:ready",{detail:{Impulse:window.Impulse}}))}),0)),"undefined"!=typeof module&&module.exports&&(module.exports={Impulse:e})}(),"undefined"!=typeof document&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",o):o())}();
//# sourceMappingURL=impulse.js.map
